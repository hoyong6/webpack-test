'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var MarkdownIt = _interopDefault(require('markdown-it'));
var fm = _interopDefault(require('front-matter'));
var loaderUtils = _interopDefault(require('loader-utils'));

var index = function (content) {
  this.cacheable && this.cacheable();

  const options = loaderUtils.getOptions(this) || {};

  const use = options.use;
  delete options.use;

  const md = new MarkdownIt(options);

  if (use) {
    for (var i = 0, list = use; i < list.length; i += 1) {
      const plugin = list[i];

      md.use(plugin);
    }
  }

  var ref = fm(content);
  var attributes = ref.attributes;
  var body = ref.body;
  const parsed = md.render(body);

  return `module.exports = ${JSON.stringify(Object.assign({}, attributes, {content: parsed}))}`
};

module.exports = index;
